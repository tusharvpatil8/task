{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { setUser, initialState } from \"store/auth/userSlice\";\nimport { onSignInSuccess,\n// onSignInSuccess,\nonSignOutSuccess, setPermissions } from \"store/auth/sessionSlice\";\nimport appConfig from \"configs/app.config\";\nimport { useNavigate } from \"react-router-dom\";\nimport { login } from \"service/authService\";\nimport { REDIRECT_URL_KEY } from \"constants/app.constant\";\nimport useQuery from \"./useQuery\";\n// import { login } from \"service/authService\";\n\nfunction useAuth() {\n  _s();\n  const dispatch = useDispatch();\n  const navigate = useNavigate();\n  const query = useQuery();\n  const {\n    token,\n    signedIn,\n    expired\n  } = useSelector(state => state.auth.session);\n  const signIn = async data => {\n    try {\n      const resp = await login(data);\n      if (resp !== null && resp !== void 0 && resp.success) {\n        var _resp$data, _resp$data$role, _resp$data2, _resp$data3, _resp$data4, _resp$data5, _resp$data5$role, _resp$data6, _resp$data7;\n        console.log(\"resp\");\n        const token = resp === null || resp === void 0 ? void 0 : resp.token;\n        console.log(\"token\", token);\n        dispatch(onSignInSuccess(token));\n        dispatch(setUser({\n          id: resp !== null && resp !== void 0 && resp.data.id ? resp === null || resp === void 0 ? void 0 : resp.data.id : \"\",\n          name: resp !== null && resp !== void 0 && resp.data.name ? resp === null || resp === void 0 ? void 0 : resp.data.name : \"user\",\n          email: resp !== null && resp !== void 0 && resp.data.email ? resp === null || resp === void 0 ? void 0 : resp.data.email : \"\",\n          role: resp !== null && resp !== void 0 && (_resp$data = resp.data) !== null && _resp$data !== void 0 && (_resp$data$role = _resp$data.role) !== null && _resp$data$role !== void 0 && _resp$data$role.role ? resp === null || resp === void 0 ? void 0 : (_resp$data2 = resp.data) === null || _resp$data2 === void 0 ? void 0 : _resp$data2.role : \"\",\n          code: resp !== null && resp !== void 0 && (_resp$data3 = resp.data) !== null && _resp$data3 !== void 0 && _resp$data3.userCode ? resp === null || resp === void 0 ? void 0 : (_resp$data4 = resp.data) === null || _resp$data4 === void 0 ? void 0 : _resp$data4.userCode : \"\",\n          authority: resp !== null && resp !== void 0 && (_resp$data5 = resp.data) !== null && _resp$data5 !== void 0 && (_resp$data5$role = _resp$data5.role) !== null && _resp$data5$role !== void 0 && _resp$data5$role.role ? resp === null || resp === void 0 ? void 0 : resp.data.role.role.split(\" \") : [\"\"],\n          token: resp !== null && resp !== void 0 && (_resp$data6 = resp.data) !== null && _resp$data6 !== void 0 && _resp$data6.token ? resp === null || resp === void 0 ? void 0 : (_resp$data7 = resp.data) === null || _resp$data7 === void 0 ? void 0 : _resp$data7.token : \"\"\n        }));\n        const redirectUrl = query.get(REDIRECT_URL_KEY);\n        navigate(redirectUrl ? redirectUrl : appConfig.authenticatedEntryPath);\n        return {\n          status: \"success\",\n          message: \"login done\"\n        };\n      } else {\n        return {\n          status: \"failed\",\n          message: (resp === null || resp === void 0 ? void 0 : resp.message) || \"Failed to log in, Please Check Your Credentials\"\n        };\n      }\n    } catch (err) {\n      var _err$response, _err$response$data, _err$response$data$er, _err$response2, _err$response2$data, _err$response3, _err$response3$data;\n      console.log(err);\n      return {\n        status: \"failed\",\n        message: (err === null || err === void 0 ? void 0 : (_err$response = err.response) === null || _err$response === void 0 ? void 0 : (_err$response$data = _err$response.data) === null || _err$response$data === void 0 ? void 0 : (_err$response$data$er = _err$response$data.error) === null || _err$response$data$er === void 0 ? void 0 : _err$response$data$er.message) || (err === null || err === void 0 ? void 0 : (_err$response2 = err.response) === null || _err$response2 === void 0 ? void 0 : (_err$response2$data = _err$response2.data) === null || _err$response2$data === void 0 ? void 0 : _err$response2$data.error) || (err === null || err === void 0 ? void 0 : (_err$response3 = err.response) === null || _err$response3 === void 0 ? void 0 : (_err$response3$data = _err$response3.data) === null || _err$response3$data === void 0 ? void 0 : _err$response3$data.message) || err.toString()\n      };\n    }\n  };\n  const handleSignOut = () => {\n    dispatch(setPermissions());\n    dispatch(onSignOutSuccess());\n    dispatch(setUser(initialState));\n    navigate(appConfig.unAuthenticatedEntryPath);\n  };\n  const signOut = async () => {\n    handleSignOut();\n  };\n  return {\n    authenticated: token && signedIn === true,\n    // authenticated: true,\n    signIn,\n    signOut\n  };\n}\n_s(useAuth, \"NF8WLqiHIbkTOjxoyuNTDy2sv9Y=\", false, function () {\n  return [useDispatch, useNavigate, useQuery, useSelector];\n});\nexport default useAuth;","map":{"version":3,"names":["useSelector","useDispatch","setUser","initialState","onSignInSuccess","onSignOutSuccess","setPermissions","appConfig","useNavigate","login","REDIRECT_URL_KEY","useQuery","useAuth","_s","dispatch","navigate","query","token","signedIn","expired","state","auth","session","signIn","data","resp","success","_resp$data","_resp$data$role","_resp$data2","_resp$data3","_resp$data4","_resp$data5","_resp$data5$role","_resp$data6","_resp$data7","console","log","id","name","email","role","code","userCode","authority","split","redirectUrl","get","authenticatedEntryPath","status","message","err","_err$response","_err$response$data","_err$response$data$er","_err$response2","_err$response2$data","_err$response3","_err$response3$data","response","error","toString","handleSignOut","unAuthenticatedEntryPath","signOut","authenticated"],"sources":["C:/Projects/task-app/admin/src/utils/hooks/useAuth.js"],"sourcesContent":["import { useSelector, useDispatch } from \"react-redux\";\r\nimport { setUser, initialState } from \"store/auth/userSlice\";\r\nimport {\r\n  onSignInSuccess,\r\n  // onSignInSuccess,\r\n  onSignOutSuccess,\r\n  setPermissions,\r\n} from \"store/auth/sessionSlice\";\r\nimport appConfig from \"configs/app.config\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { login } from \"service/authService\";\r\nimport { REDIRECT_URL_KEY } from \"constants/app.constant\";\r\nimport useQuery from \"./useQuery\";\r\n// import { login } from \"service/authService\";\r\n\r\nfunction useAuth() {\r\n  const dispatch = useDispatch();\r\n  const navigate = useNavigate();\r\n  const query = useQuery();\r\n\r\n  const { token, signedIn, expired } = useSelector(\r\n    (state) => state.auth.session\r\n  );\r\n  const signIn = async (data) => {\r\n    try {\r\n      const resp = await login(data);\r\n      if (resp?.success) {\r\n        console.log(\"resp\");\r\n        const token = resp?.token;\r\n        console.log(\"token\", token);\r\n        dispatch(onSignInSuccess(token));\r\n        dispatch(\r\n          setUser({\r\n            id: resp?.data.id ? resp?.data.id : \"\",\r\n            name: resp?.data.name ? resp?.data.name : \"user\",\r\n            email: resp?.data.email ? resp?.data.email : \"\",\r\n            role: resp?.data?.role?.role ? resp?.data?.role : \"\",\r\n            code: resp?.data?.userCode ? resp?.data?.userCode : \"\",\r\n            authority: resp?.data?.role?.role\r\n              ? resp?.data.role.role.split(\" \")\r\n              : [\"\"],\r\n            token: resp?.data?.token ? resp?.data?.token : \"\",\r\n          })\r\n        );\r\n        const redirectUrl = query.get(REDIRECT_URL_KEY);\r\n\r\n        navigate(redirectUrl ? redirectUrl : appConfig.authenticatedEntryPath);\r\n\r\n        return {\r\n          status: \"success\",\r\n          message: \"login done\",\r\n        };\r\n      } else {\r\n        return {\r\n          status: \"failed\",\r\n          message:\r\n            resp?.message || \"Failed to log in, Please Check Your Credentials\",\r\n        };\r\n      }\r\n    } catch (err) {\r\n      console.log(err);\r\n      return {\r\n        status: \"failed\",\r\n        message:\r\n          err?.response?.data?.error?.message ||\r\n          err?.response?.data?.error ||\r\n          err?.response?.data?.message ||\r\n          err.toString(),\r\n      };\r\n    }\r\n  };\r\n\r\n  const handleSignOut = () => {\r\n    dispatch(setPermissions());\r\n    dispatch(onSignOutSuccess());\r\n    dispatch(setUser(initialState));\r\n    navigate(appConfig.unAuthenticatedEntryPath);\r\n  };\r\n\r\n  const signOut = async () => {\r\n    handleSignOut();\r\n  };\r\n\r\n  return {\r\n    authenticated: token && signedIn === true,\r\n    // authenticated: true,\r\n    signIn,\r\n    signOut,\r\n  };\r\n}\r\n\r\nexport default useAuth;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}